/*! platform 14-10-2013 */
angular.module("platform").controller("Micropost",function(a,b){var c=b.Micropost;a.addMicropost=function(b){if(b.trim().length){var d=new c({content:b});d.$save(function(b){a.microposts.push(b)}),a.micropostContent=""}},a.showMicropost=function(){c.query(function(b){a.microposts=b})},a.showMicropost(),a.deleteMicropost=function(b){a.microposts[b].$remove(function(){a.microposts.splice(b,1)})}}),angular.module("platform").directive("userport",function(){return{restrict:"E",scope:!0,templateUrl:"/partials/userport.html",controller:"Userport"}}).controller("Userport",function(a,b,c){a.state="out",a.errorMessage=null,a.changeState=function(b){a.state=b},a.login=function(b,d){c.login(b,d).then(null,function(b){a.errorMessage=b.data})},a.logout=function(){c.logout()},a.register=function(d,e,f){var g=new b.User({username:d,pw:e,email:f});g.$save(function(){c.verify()},function(b){a.errorMessage=b.data})},a.$watch("state",function(b){"in"==b&&(a.errorMessage=null)}),a.userState=c.getState(),a.$watch("userState.logging",function(b){a.state=b?"in":"out"})}),angular.module("platform",["ngResource","ngRoute"]).factory("models",function(a){return{Micropost:a("/microposts/:id",{id:"@_id"}),User:a("/users/:id",{id:"@_id"})}}).factory("self",function(a,b,c,d){function e(){var a=b.get("/verify");a.then(function(a){f.info=a.data,f.logging=!0},function(){f.logging=!1}),d.watch(a)}var f={};return e(),{login:function(a,c){var f=b.post("/login",{username:a,pw:c});return f.then(function(){e()},function(a){console.log(a)}),d.watch(f),f},logout:function(){b.post("/logout").then(function(){f.logging=!1},function(a){console.log(a)})},getState:function(){return f},verify:e}}).factory("progressService",function(a){return{watch:function(b){NProgress.start(),a.when(b,function(){NProgress.done()},function(){NProgress.done(),NProgress.remove()})}}});